<div class="modal-overlay">
  <div class="modal-container">
    <!-- Modal Header -->
    <div class="modal-header">
      <div>
        <h2>Schedule New Delivery</h2>
      </div>
      <button class="btn-close" (click)="closeDialog()" title="Close">
        <mat-icon>close</mat-icon>
      </button>
    </div>

    <!-- Tab Navigation -->
    <div class="tab-navigation">
      <button
        class="tab-button"
        [class.active]="activeTab === 'delivery-info'"
        [class.completed]="isTabValid('delivery-info') && activeTab !== 'delivery-info'"
        (click)="setTab('delivery-info')"
      >
        Delivery Info
      </button>
      <button
        class="tab-button"
        [class.active]="activeTab === 'customer'"
        [class.completed]="isTabValid('customer') && activeTab !== 'customer'"
        (click)="setTab('customer')"
      >
        Customer
      </button>
      <button
        class="tab-button"
        [class.active]="activeTab === 'package'"
        [class.completed]="isTabValid('package') && activeTab !== 'package'"
        (click)="setTab('package')"
      >
        Package
      </button>
      <button
        class="tab-button"
        [class.active]="activeTab === 'assignment'"
        (click)="setTab('assignment')"
      >
        Assignment
      </button>
    </div>

    <!-- Modal Content -->
    <div class="modal-content">
      <!-- Delivery Info Tab -->
      <div class="tab-content" *ngIf="activeTab === 'delivery-info'">
        <div class="section-header">
          <mat-icon>local_shipping</mat-icon>
          <h3>Delivery Information</h3>
        </div>

        <form [formGroup]="deliveryForm">
          <div class="form-row">
            <div class="form-group">
              <label>Delivery Type</label>
              <select formControlName="deliveryType">
                <option *ngFor="let type of deliveryTypes" [value]="type">{{ type }}</option>
              </select>
            </div>

            <div class="form-group">
              <label>Priority</label>
              <select formControlName="priority">
                <option *ngFor="let priority of priorities" [value]="priority">{{ priority }}</option>
              </select>
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Delivery Date <span class="required">*</span></label>
              <input type="date" formControlName="deliveryDate" />
            </div>

            <div class="form-group">
              <label>Preferred Time</label>
              <input type="time" formControlName="preferredTime" />
            </div>
          </div>

          <div class="form-group">
            <label>Estimated Duration (minutes)</label>
            <input type="number" formControlName="estimatedDuration" min="1" />
          </div>
        </form>
      </div>

      <!-- Customer Tab -->
      <div class="tab-content" *ngIf="activeTab === 'customer'">
        <div class="section-header">
          <mat-icon>location_on</mat-icon>
          <h3>Customer & Address Information</h3>
        </div>

        <form [formGroup]="deliveryForm">
          <div class="form-row">
            <div class="form-group">
              <label>Customer ID</label>
              <select formControlName="customerId">
                <option value="">Select existing customer</option>
                <option *ngFor="let customer of customers" [value]="customer.id">
                  {{ customer.name }}
                </option>
              </select>
            </div>

            <div class="form-group">
              <label>Customer Name <span class="required">*</span></label>
              <input type="text" formControlName="customerName" placeholder="Enter customer name" />
            </div>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Customer Phone</label>
              <input type="tel" formControlName="customerPhone" placeholder="+254 XXX XXX XXX" />
            </div>

            <div class="form-group">
              <label>Customer Email</label>
              <input type="email" formControlName="customerEmail" placeholder="customer@example.com" />
            </div>
          </div>

          <div class="form-group">
            <label>Pickup Address</label>
            <textarea formControlName="pickupAddress" rows="2" placeholder="Enter pickup address (leave empty if from warehouse)"></textarea>
          </div>

          <div class="form-group">
            <label>Delivery Address <span class="required">*</span></label>
            <textarea formControlName="deliveryAddress" rows="3" placeholder="Enter complete delivery address"></textarea>
          </div>

          <div class="form-group">
            <label>Delivery Instructions</label>
            <textarea formControlName="deliveryInstructions" rows="2" placeholder="Special instructions for the driver..."></textarea>
          </div>

          <div class="form-row">
            <div class="form-group">
              <label>Contact Person</label>
              <input type="text" formControlName="contactPerson" placeholder="Person to receive delivery" />
            </div>

            <div class="form-group">
              <label>Contact Phone</label>
              <input type="tel" formControlName="contactPhone" placeholder="+254 XXX XXX XXX" />
            </div>
          </div>
        </form>
      </div>

      <!-- Package Tab -->
      <div class="tab-content" *ngIf="activeTab === 'package'">
        <div class="section-header">
          <mat-icon>inventory_2</mat-icon>
          <h3>Package Information</h3>
        </div>

        <form [formGroup]="deliveryForm">
          <div class="form-row">
            <div class="form-group">
              <label>Package Weight (kg)</label>
              <input type="number" formControlName="packageWeight" placeholder="0" min="0" step="0.1" />
            </div>

            <div class="form-group">
              <label>Dimensions (L x W x H cm)</label>
              <input type="text" formControlName="packageDimensions" placeholder="e.g., 30 x 20 x 15" />
            </div>
          </div>

          <div class="form-group">
            <label>Package Value (KSH)</label>
            <input type="number" formControlName="packageValue" placeholder="0" min="0" />
          </div>

          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="requiresSignature" />
              <span>Requires Signature</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" formControlName="fragileItem" />
              <span>Fragile Item</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" formControlName="hazardousMaterial" />
              <span>Hazardous Material</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" formControlName="cashOnDelivery" />
              <span>Cash on Delivery</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" formControlName="deliveryInsurance" />
              <span>Delivery Insurance</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" formControlName="gpsTracking" />
              <span>GPS Tracking</span>
            </label>
          </div>
        </form>
      </div>

      <!-- Assignment Tab -->
      <div class="tab-content" *ngIf="activeTab === 'assignment'">
        <div class="section-header">
          <mat-icon>engineering</mat-icon>
          <h3>Driver & Vehicle Assignment</h3>
        </div>

        <form [formGroup]="deliveryForm">
          <div class="form-row">
            <div class="form-group">
              <label>Assigned Driver</label>
              <select formControlName="assignedDriver">
                <option value="">Select driver</option>
                <option *ngFor="let driver of drivers" [value]="driver">{{ driver }}</option>
              </select>
            </div>

            <div class="form-group">
              <label>Assigned Vehicle</label>
              <select formControlName="assignedVehicle">
                <option value="">Select vehicle</option>
                <option *ngFor="let vehicle of vehicles" [value]="vehicle">{{ vehicle }}</option>
              </select>
            </div>
          </div>

          <div class="form-group">
            <label>Delivery Route</label>
            <select formControlName="deliveryRoute">
              <option value="">Select or create route</option>
              <option *ngFor="let route of deliveryRoutes" [value]="route">{{ route }}</option>
            </select>
          </div>

          <div class="checkbox-group">
            <label class="checkbox-label">
              <input type="checkbox" formControlName="smsNotification" />
              <span>SMS Notifications to Customer</span>
            </label>

            <label class="checkbox-label">
              <input type="checkbox" formControlName="emailNotification" />
              <span>Email Notifications to Customer</span>
            </label>
          </div>

          <div class="form-group">
            <label>Additional Notes</label>
            <textarea formControlName="additionalNotes" rows="4" placeholder="Any additional notes for this delivery..."></textarea>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="modal-footer">
      <button class="btn-secondary" (click)="closeDialog()">
        Cancel
      </button>

      <button class="btn-primary" (click)="scheduleDelivery()">
        <mat-icon>schedule</mat-icon>
        Schedule Delivery
      </button>
    </div>
  </div>
</div>
