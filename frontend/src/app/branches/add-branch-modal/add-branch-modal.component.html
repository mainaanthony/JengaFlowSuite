<app-modal
  [config]="modalConfig"
  [contentTemplate]="branchFormTemplate"
  [leftButtons]="getLeftButtons()"
  [rightButtons]="getRightButtons()"
  (buttonClicked)="handleButtonClick($event)">
</app-modal>

<ng-template #branchFormTemplate>
  <div class="modal-content-wrapper">
    <!-- Tabs Navigation -->
    <app-tabs
      [tabs]="tabsWithState"
      [activeTabId]="activeTabId"
      [stretch]="true"
      (tabChanged)="onTabChange($event)">
    </app-tabs>

    <!-- Tab 1: Basic Info -->
    <div *ngIf="activeTabId === '1'" class="tab-content" [formGroup]="basicInfoForm">
      <h3>Basic Information</h3>

      <div class="form-row">
        <app-input-text
          [config]="{
            label: 'Branch Name',
            placeholder: 'Enter branch name',
            required: true
          }"
          formControlName="branchName">
        </app-input-text>

        <app-input-text
          [config]="{
            label: 'Branch Code',
            placeholder: 'e.g., NRB-001',
            required: true
          }"
          formControlName="branchCode">
        </app-input-text>
      </div>

      <div class="form-row">
        <app-input-dropdown
          [options]="branchTypes"
          [config]="{
            placeholder: 'Select branch type',
            searchable: true
          }"
          (selectionChanged)="basicInfoForm.patchValue({ branchType: $event })">
        </app-input-dropdown>
      </div>

      <div class="form-row">
        <app-input-text
          [config]="{
            label: 'Phone Number',
            placeholder: 'Enter phone number',
            type: 'tel'
          }"
          formControlName="phoneNumber">
        </app-input-text>

        <app-input-text
          [config]="{
            label: 'Email Address',
            placeholder: 'Enter email address',
            type: 'email'
          }"
          formControlName="emailAddress">
        </app-input-text>
      </div>

      <!-- Branch Manager Details -->
      <div class="section-header">
        <mat-icon>person</mat-icon>
        <h4>Branch Manager Details</h4>
      </div>

      <div class="form-row">
        <app-input-text
          [config]="{
            label: 'Manager Name',
            placeholder: 'Manager\'s full name'
          }"
          formControlName="managerName">
        </app-input-text>

        <app-input-text
          [config]="{
            label: 'Manager Phone',
            placeholder: 'Manager\'s phone',
            type: 'tel'
          }"
          formControlName="managerPhone">
        </app-input-text>

        <app-input-text
          [config]="{
            label: 'Manager Email',
            placeholder: 'Manager\'s email',
            type: 'email'
          }"
          formControlName="managerEmail">
        </app-input-text>
      </div>
    </div>

    <!-- Tab 2: Location -->
    <div *ngIf="activeTabId === '2'" class="tab-content" [formGroup]="locationForm">
      <div class="section-header">
        <mat-icon>location_on</mat-icon>
        <h4>Address Information</h4>
      </div>

      <div class="form-group">
        <app-input-text
          [config]="{
            label: 'Street Address',
            placeholder: 'Enter complete street address',
            required: true,
            rows: 3
          }"
          formControlName="streetAddress">
        </app-input-text>
      </div>

      <div class="form-row">
        <app-input-text
          [config]="{
            label: 'City',
            placeholder: 'Enter city'
          }"
          formControlName="city">
        </app-input-text>

        <div class="form-group">
          <label class="form-label">County</label>
          <app-input-dropdown
            [options]="counties"
            [config]="{
              placeholder: 'Select county',
              searchable: true
            }"
            (selectionChanged)="locationForm.patchValue({ county: $event?.label })">
          </app-input-dropdown>
        </div>
      </div>

      <div class="form-row">
        <app-input-text
          [config]="{
            label: 'Postal Code',
            placeholder: 'Enter postal code'
          }"
          formControlName="postalCode">
        </app-input-text>

        <div class="form-group">
          <label class="form-label">Country <span class="required">*</span></label>
          <app-input-dropdown
            [options]="countries"
            [config]="{
              placeholder: 'Select country',
              searchable: true
            }"
            (selectionChanged)="locationForm.patchValue({ country: $event })">
          </app-input-dropdown>
        </div>
      </div>

      <!-- GPS Coordinates -->
      <div class="section-header">
        <mat-icon>map</mat-icon>
        <h4>GPS Coordinates (Optional)</h4>
      </div>

      <div class="form-row">
        <app-input-text
          [config]="{
            label: 'Latitude',
            placeholder: 'e.g., -1.286389'
          }"
          formControlName="latitude">
        </app-input-text>

        <app-input-text
          [config]="{
            label: 'Longitude',
            placeholder: 'e.g., 36.817223'
          }"
          formControlName="longitude">
        </app-input-text>
      </div>
    </div>

    <!-- Tab 3: Operations -->
    <div *ngIf="activeTabId === '3'" class="tab-content" [formGroup]="operationsForm">
      <div class="section-header">
        <mat-icon>schedule</mat-icon>
        <h4>Operating Hours</h4>
      </div>

      <div class="operating-hours">
        <div class="hours-row" *ngFor="let hours of operatingHours; let i = index">
          <div class="day-label">{{ hours.day }}</div>
          <div class="open-toggle">
            <input
              type="checkbox"
              [id]="'day-' + i"
              [checked]="hours.open"
              (change)="toggleDay(i)"
            />
            <label [for]="'day-' + i">Open</label>
          </div>
          <div class="time-inputs" *ngIf="hours.open">
            <input type="time" [(ngModel)]="hours.startTime" [ngModelOptions]="{standalone: true}" />
            <span class="to-label">to</span>
            <input type="time" [(ngModel)]="hours.endTime" [ngModelOptions]="{standalone: true}" />
          </div>
        </div>
      </div>

      <!-- Services Offered -->
      <div class="section-header">
        <mat-icon>local_offer</mat-icon>
        <h4>Services Offered</h4>
      </div>

      <div class="services-grid">
        <div class="service-item" *ngFor="let service of services">
          <input
            type="checkbox"
            [id]="service.id"
            [checked]="service.checked"
            (change)="toggleService(service.id)"
          />
          <label [for]="service.id">{{ service.label }}</label>
        </div>
      </div>
    </div>

    <!-- Tab 4: Settings -->
    <div *ngIf="activeTabId === '4'" class="tab-content" [formGroup]="settingsForm">
      <div class="section-header">
        <mat-icon>settings</mat-icon>
        <h4>Branch Settings</h4>
      </div>

      <div class="form-row">
        <app-input-text
          [config]="{
            label: 'Initial Staff Count',
            placeholder: 'Number of initial staff',
            type: 'number'
          }"
          formControlName="initialStaffCount">
        </app-input-text>

        <app-input-text
          [config]="{
            label: 'Monthly Revenue Target (KSH)',
            placeholder: 'Target monthly revenue',
            type: 'number'
          }"
          formControlName="monthlyRevenueTarget">
        </app-input-text>
      </div>

      <div class="form-row">
        <app-input-text
          [config]="{
            label: 'Expected Opening Date',
            type: 'date'
          }"
          formControlName="expectedOpeningDate">
        </app-input-text>
      </div>

      <div class="form-group">
        <app-input-text
          [config]="{
            label: 'Additional Notes',
            placeholder: 'Any additional information about the branch',
            rows: 4
          }"
          formControlName="additionalNotes">
        </app-input-text>
      </div>
    </div>
  </div>
</ng-template>
