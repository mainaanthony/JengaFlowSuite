<div class="users">
  <!-- Page Header -->
  <div class="page-header">
    <div>
      <h1>User Management</h1>
      <p>Manage users, roles, and permissions across all branches</p>
    </div>
    <div class="header-actions">
      <app-button-solid variant="secondary" (click)="manageRoles()">
        <mat-icon>settings</mat-icon>
        Manage Roles
      </app-button-solid>
      <app-button-solid variant="primary" (click)="addUser()">
        <mat-icon>add</mat-icon>
        Add User
      </app-button-solid>
    </div>
  </div>

  <!-- Stats Grid -->
  <div class="stats-grid">
    <app-stat-card
      *ngFor="let stat of stats"
      [title]="stat.label"
      [value]="stat.value"
      [delta]="stat.delta">
    </app-stat-card>
  </div>

  <!-- Tabs Navigation -->
  <div class="tabs-container">
    <button
      class="tab"
      [class.active]="activeTab === 'all-users'"
      (click)="setTab('all-users')">
      All Users
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'roles-permissions'"
      (click)="setTab('roles-permissions')">
      Roles & Permissions
    </button>
    <button
      class="tab"
      [class.active]="activeTab === 'activity-logs'"
      (click)="setTab('activity-logs')">
      Activity Logs
    </button>
  </div>

  <!-- All Users Tab -->
  <app-card class="section-card" *ngIf="activeTab === 'all-users'">
    <div class="section-header">
      <div>
        <h2>User Directory</h2>
        <p>Manage user accounts and permissions</p>
      </div>
      <div class="search-container">
        <mat-icon>search</mat-icon>
        <input
          type="text"
          placeholder="Search users..."
          [formControl]="searchControl"
          class="search-input">
        <button class="filter-btn">
          <mat-icon>tune</mat-icon>
          Filter
        </button>
      </div>
    </div>

    <!-- Users Table -->
    <div class="table-container">
      <table class="users-table">
        <thead>
          <tr>
            <th>User</th>
            <th>Role</th>
            <th>Branch</th>
            <th>Contact</th>
            <th>Status</th>
            <th>Last Login</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let user of filteredUsers" class="user-row">
            <td class="user-cell">
              <div class="user-info">
                <div class="user-avatar">{{ user.initials }}</div>
                <div class="user-details">
                  <span class="user-name">{{ user.name }}</span>
                  <span class="user-id">{{ user.id }}</span>
                </div>
              </div>
            </td>
            <td class="role-cell">
              <span class="role-badge" [style.background-color]="getRoleColor(user.role)">
                {{ user.role }}
              </span>
            </td>
            <td class="branch-cell">{{ user.branch }}</td>
            <td class="contact-cell">
              <div class="contact-info">
                <div class="contact-email">
                  <mat-icon>email</mat-icon>
                  {{ user.email }}
                </div>
                <div class="contact-phone">
                  <mat-icon>phone</mat-icon>
                  {{ user.phone }}
                </div>
              </div>
            </td>
            <td class="status-cell">
              <span [class]="'status-badge ' + getStatusClass(user.status)">
                {{ user.status | titlecase }}
              </span>
            </td>
            <td class="date-cell">
              <mat-icon class="date-icon">calendar_today</mat-icon>
              {{ user.lastLogin }}
            </td>
            <td class="actions-cell">
              <button class="action-btn" (click)="editUser(user)" title="Edit">
                <mat-icon>edit</mat-icon>
              </button>
              <button class="action-btn" (click)="toggleUserStatus(user)" title="Toggle Status">
                <mat-icon>{{ user.status === 'active' ? 'check_circle' : 'cancel' }}</mat-icon>
              </button>
              <button class="action-btn delete" (click)="deleteUser(user)" title="Delete">
                <mat-icon>delete</mat-icon>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </app-card>

  <!-- Roles & Permissions Tab -->
  <div *ngIf="activeTab === 'roles-permissions'" class="section-content">
    <app-card class="roles-header-card">
      <div class="roles-header">
        <h2>Roles & Permissions</h2>
        <p>Define user roles and their system permissions</p>
      </div>
    </app-card>

    <div class="roles-grid">
      <app-card class="role-card" *ngFor="let role of roles">
        <div class="role-header">
          <h3>{{ role.name }}</h3>
          <span class="user-count">{{ role.userCount }} users</span>
        </div>

        <p class="role-description">{{ role.description }}</p>

        <div class="permissions-list">
          <div class="permissions-label">Key Permissions:</div>
          <div *ngFor="let permission of role.permissions" class="permission-item">
            <mat-icon>check_circle</mat-icon>
            <span>{{ permission }}</span>
          </div>
        </div>

        <button class="manage-btn" (click)="editRole(role)">
          <mat-icon>settings</mat-icon>
          Manage Role
        </button>
      </app-card>
    </div>
  </div>

  <!-- Activity Logs Tab -->
  <app-card class="section-card" *ngIf="activeTab === 'activity-logs'">
    <div class="section-header">
      <div>
        <h2>User Activity Logs</h2>
        <p>Track user actions and system access</p>
      </div>
      <div class="logs-actions">
        <app-button-solid variant="secondary" (click)="exportLogs()">
          <mat-icon>download</mat-icon>
          Export
        </app-button-solid>
      </div>
    </div>

    <!-- Empty State for Activity Logs -->
    <div class="empty-state">
      <div class="empty-icon">
        <mat-icon>trending_up</mat-icon>
      </div>
      <h3>Activity Monitoring</h3>
      <p>Monitor user logins, actions, and system access patterns</p>
      <app-button-solid variant="primary" (click)="viewActivityLogs()">
        <mat-icon>insights</mat-icon>
        View Activity Logs
      </app-button-solid>
    </div>
  </app-card>
</div>
